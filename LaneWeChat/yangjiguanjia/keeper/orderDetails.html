<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>订单详情</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name = "format-detection" content = "telephone=no">
		<script src="assets/js/rem.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="assets/css/reset.css"/>
		<link rel="stylesheet" type="text/css" href="assets/css/weui.css"/>
		<style type="text/css">
			html,body{background: #f7f7f7;}
			header{width: 100%;height: .93rem;border-bottom: 1px solid #e6e6e6;background: #f7f7f7;overflow: hidden;}
			header div img{display: inline-block;width: .35rem;margin-right: .06rem;}
			header div{text-align: center;font-size: .32rem;color: #666666;margin-top: .24rem;}
			section ul{width: 100%;}
			section ul li{width: 100%;height: .98rem;border-bottom: 1px solid #e6e6e6;line-height: .98rem;font-size: .32rem;
			color: #4d4d4d;overflow: hidden;position: relative;background: white;}
			section ul li .red{color: #fe3057;}
			section ul li .left{margin-left: .29rem;float: left;line-height: .98rem;height: .98rem;}
			section ul li input{display:inline-block;text-align: right;float: right;font-size: .32rem;line-height: .98rem;
			margin-right: .3rem;}
			section ul li .danwei{padding-right: .35rem;}
			section ul li .word img{width: .2rem;display: inline-block;}
			section ul li .word .ownerImg{width: .38rem;}
			section ul li .word{position: absolute;right: .2rem;top: .32rem;overflow: hidden;display: block;}
			section ul li  .txt{top: 0;}
			section{width: 100%;text-align: center;}
			section .next{width: 100%;height: 1rem;text-align: center;line-height: 1rem;color: white;background: #faca3a;
			margin-top: 1rem;font-size: .3rem;display: block;}
			.left sup{display: inline-block;}
			
			.right{color: #76abef;line-height: .98rem;margin-right: .3rem;float: right;}
			.right .type{margin-left: .14rem;}
		
		/*	#actionSheet_wrap{display: none;}*/
			.chickenType{display:inline-block;text-align: right;float: right;font-size: .32rem;line-height: .98rem;
			margin-right: .3rem;}
		</style>
	</head>
	<body>
		<header>
			<div>
				<img src="assets/images/list.png"/>订单号：<span class="orderNum">201605180962</span>
			</div>
		</header>
		<section>
			<ul>
				<li>
					<div class="left">
						姓名<span class="red">*</span>
					</div>
					<input type="text" placeholder="真实姓名" id="realName"/>
				</li>
				<li>
					<div class="left">
						身份证号<span class="red">*</span>
					</div>
					<input type="text"  placeholder="仅支持中国大陆身份证" id="IDcard"/>
				</li>
				<li>
					<div class="left">
						手机号<span class="red">*</span>
					</div>
					<input type="tel" placeholder="11位手机号" id="phone" onkeyup="this.value=this.value.replace(/\D/gi,'')"/>
				</li>
				<li>
					<div class="left">
						家庭住址<span class="red">*</span>
					</div>
					<input  placeholder="请输入" style="width: 4.75rem;" class="homeAdress"/>
				</li>
				<li>
					<div class="left">
						蛋鸡品种<span class="red">*</span>
					</div>
					<input class="danwei chickenType"   placeholder="请选择" type="text"  readonly="readonly" id="hens_breed"/><span class="word chooseType"  id="showActionSheet"><img src="assets/images/go.jpg"/></span>
				</li>
				<li>
					<div class="left">
						投保数量<span class="red">*</span>
					</div>
					<input type="text"  placeholder="请输入" class="danwei" id="hens_count"/><span class="word txt">只</span>
				</li>
				<li>
					<div class="left">
						蛋鸡鸡龄<span class="red">*</span>
					</div>
					<input type="text" placeholder="本投保批次鸡龄" class="chickenAge" id="hens_days"/>
				</li>
				<li>
					<div class="left">
						鸡场大小<span class="red">*</span>
					</div>
					<input type="text" placeholder="请输入" class="danwei checkNum" id="area"/><span class="word txt" style="font-size: .36rem;">㎡</span>
				</li>
				<li>
					<div class="left">
						鸡场现日均产蛋量<span class="red">*</span>
					</div>
					<input type="text"  placeholder="请输入" class="danwei checkNum" id="chandanliang"/><span class="word txt">斤</span>
				</li>
				<li>
					<div class="left">
						持卡人<span class="red">*</span>
					</div>
					<input type="text"  value="" placeholder="某某某" class="danwei" id="card_name"/><span class="word"><img src="assets/images/cardowner.png" class="ownerImg"/></span>
				</li>
				<li>
					<div class="left">
						卡号<span class="red">*</span>
					</div>
					<input type="tel" value="" placeholder="请输入" class="cardNum" onkeyup="this.value=this.value.replace(/\D/g,'').replace(/....(?!$)/g,'$& ')" style="width: 4.75rem;" />
				</li>
				<li>
					<div class="left">
						卡类型<span class="red">*</span>
					</div>
					<div class="right">
						<span class="bank" id="card_type"></span><span class="type"></span>
					</div>
				</li>
			</ul>
			<a href="javascript:void(0)" class="next">下一步</a>
		</section>
		
		<div id="loadingToast" class="weui_loading_toast" style="display:none;">
			    <div class="weui_mask_transparent"></div>
			    <div class="weui_toast">
			        <div class="weui_loading">
			            <div class="weui_loading_leaf weui_loading_leaf_0"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_1"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_2"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_3"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_4"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_5"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_6"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_7"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_8"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_9"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_10"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_11"></div>
			        </div>
			        <p class="weui_toast_content" style="color: #FFFFFF;">数据提交中！</p>
			    </div>
		</div>
		
		
		<div id="actionSheet_wrap">
		    <div class="weui_mask_transition" id="mask" style="display: none;"></div>
		    <div class="weui_actionsheet" id="weui_actionsheet">
		        <div class="weui_actionsheet_menu">
		            <div class="weui_actionsheet_cell option">京红</div>
		            <div class="weui_actionsheet_cell option">京粉</div>
		            <div class="weui_actionsheet_cell option">海蓝褐</div>
		            <div class="weui_actionsheet_cell option">海蓝灰</div>
		            <div class="weui_actionsheet_cell option">海蓝白</div>
		            <div class="weui_actionsheet_cell option">农大3号</div>
		            <div class="weui_actionsheet_cell option">其他</div>
		        </div>
		        <div class="weui_actionsheet_action">
		            <div class="weui_actionsheet_cell" id="actionsheet_cancel">取消</div>
		        </div>
		    </div>
		</div>
		
		
		
		<script src="assets/js/zepto.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="assets/js/zepto.tap.js" type="text/javascript" charset="utf-8"></script>
		<script src="assets/conf/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="assets/js/md5-min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
//			$(".homeAdress").on("blur",function(){
//				var details=$(".homeAdress").val();
//				if(details.length>15){
//					details.substring(12);
//			    }
//			})
		$(function(){
			
			if(localStorage.getItem("orderInfo")){
				var num = JSON.parse(localStorage.getItem("orderInfo")).orderNum;
				var version="1.2.2";
				var signature=hex_md5("order_sn="+num+"&version=1.2.2"+version+"Tv,cM02kjf^lWoU")
				$.get(validate.url+"/Api/Order/getOrderBySN?order_sn="+num+"&signature="+signature+"&version="+version,{},function(data){
					if(data.code===1){
						$(".orderNum").text(data.result.order_sn);
						$(".chickenType").val(data.result.hens_breed);
						$(".chickenAge").val(data.result.hens_days+"天")
						//localStorage.setItem("orderDetails",JSON.stringify({"orderNum":num,"address":address,"condition":condition,"count":count,"time":time,"goodName":goodName,"tel":tel}))
					}else{
						alert(data.msg)
					}
				})
			};
			
			
			
			
			
			
			
//			console.log(JSON.parse(localStorage.getItem("orderInfo")).orderNum);
			$(".checkNum").bind("keyup",function(){
					checkNum(this)
			})
			
			function checkNum(obj) {
		     //检查是否是非数字值 只能带两位小数
		     
		      if(/^\d+\.?\d{0,2}$/.test(obj.value)){
			        obj.value = obj.value;
			    }else{
			   		obj.value = obj.value.substring(0,obj.value.length-1);
				}
		    }
			
			
			
//			var count=0;
//			$("input").each(function(){
//				if($(this).val()==""){
//					count++;
//				}else if(count==0){
//					$(".next").css({"background":"#faca3a","color":"white"})
//				}
//			})
//
//			$("input").on("blur",function(){	
//					if($(this).val()!=""){
//						count--;
//						console.log(count)
//	
//					}
//					if(count==0){
//						$(".next").css({"background":"#faca3a","color":"white"})	
//					}
//			})
			
			
			
			$(".chickenType").on("tap",function(){
				$("#mask").css("display","block");
				$("#mask").addClass("weui_fade_toggle")
				$("#weui_actionsheet").addClass("weui_actionsheet_toggle")
				$("#actionsheet_cancel").on("tap",function(){
					$("#mask").css("display","");
					$("#mask").removeClass("weui_fade_toggle")
					$("#weui_actionsheet").removeClass("weui_actionsheet_toggle")
				})
				$(".option").on("tap",function(){
					$("#mask").css("display","");
					$("#mask").removeClass("weui_fade_toggle")
					$("#weui_actionsheet").removeClass("weui_actionsheet_toggle")
					var type=$(this).html()
					$(".chickenType").val(type);
				})
	
				$("#mask").on("tap",function(){
					$("#mask").css("display","");
					$("#mask").removeClass("weui_fade_toggle")
					$("#weui_actionsheet").removeClass("weui_actionsheet_toggle")
				})	
				
				
			})
			
			
			
			
			
			$(".next").on("tap",function(event){
				
				var phone=$("#phone"),idCard=$("#IDcard"),realName=$("#realName"),hens_breed=$("#hens_breed"),hens_count=$("#hens_count"),hens_days=$("#hens_days"),chandanliang=$("#chandangliang"),card_name=$("#card_name");
				
				event.preventDefault();
				var count = 0;
			    $("input").each(function(){
			        if ($(this).val() == ""){
			            count++;
			        }
			    }); 
			    if(count >0 ){
			        alert("请填写完整信息！");
			    }
			    if(count==0){
			    	var params={};
			    	params.address=$(".homeAdress").val();
			    	params.area=$(".homeAddress").val();
			    	params.card_no=$(".cardNum").val().replace(/\s+/g,"");
			    	params.card_name=card_name.val()
					params.card_type=$("#card_type").html()
					params.chandanliang=chandanliang.val()
					params.hens_breed=hens_breed.val()
					params.hens_count=hens_count.val()
					params.hens_days=hens_days.val()
					params.IDcard=$.trim(idCard.val());
			    	params.name=realName.val();
			    	params.tel=$.trim(phone.val());
					
					

					
					if(!validate.phone(params.tel)){
						alert("请输入正确的手机号!")	
						return
					}
					if(!validate.card(params.IDcard)){
						alert("请输入正确的身份证号码!")	
						return
					}
					if(!validate.bankNum(params.card_no)){
						alert("请输入正确的银行卡号!")	
						return
					}
					var version="1.2.2";
					var signature=hex_md5(version+"address="+params.address+"&area="+params.area+"&card_no="+params.card_no+"&card_name="+params.card_name+"&card_type="+params.card_type+"&chandanliang="+params.chandanliang+"&hens_breed="+params.hens_breed+"&hens_count="+params.hens_count+"&hens_days="+params.hens_days+"&IDcard="+params.IDcard+"&name="+params.name+"&tel="+params.tel+"&version=1.2.2"+"Tv,cM02kjf^lWoU");
					params.signature=signature;
					params.version=version;
					
			    	$.post(validate.url+"/Api/Keeper/upOrderCommit",params,function(data){
						//$('#loadingToast').show();
						if(data.code===1){
							
						
								//这个跳转不能改变 调用sdk的url已经写死
								location.href="identityInfo.html?getTimestamp="+new Date().getTime();
								//";
							
						}else{
							alert(data.msg)
							//$('#loadingToast').hide();
						}
					})
			    }
			})

			
			
			$(".cardNum").on("blur",function(){
				  var bankNum=$(".cardNum").val().replace(/\s+/g,"");
				  if(!validate.bankNum(bankNum)){
						alert("请输入正确的银行卡号!")	
						return
				};
				　$.ajax({
					type:"GET",
					url:validate.url+"/getCardInfo/validateAndCacheCardInfo.json?_input_charset=utf-8&cardNo="+bankNum+"&cardBinCheck=true",
					success:function(data){
			　　　　　　//这里的success方法是不会执行的，会调用上传pandoraCall方法，该方法名和服务器回传内容的方法名一致
					　　var bank=data.bank
						
						$(".bank").html(validate.banks[bank])
						if(data.cardType=="DC"){
							$(".type").html("储蓄卡");
						}else if(data.cardType=="CC"){
							$(".type").html("信用卡");
						}
					},
					error:function(e){
					　　alert(e);
					}
				　});

				})
			
			})
			
		</script>
		
	</body>
</html>
