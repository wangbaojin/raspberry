<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>养鸡日志</title>
		<script src="assets/js/rem.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="assets/css/reset.css"/>
		<style type="text/css">
			html,body{background: #f7f7f7;}
			.head{background: white;height: .9rem;border-bottom: 1px solid #e6e6e6;font-size: .3rem;color: #4d4d4d;line-height: .9rem;}
			.blue{width: .3rem;height: .3rem;border-radius: 50%;background: #75aaf0;margin-left: .2rem;display: inline-block;margin-left: .2rem;margin-right: .17rem;}
			
			.data{width: 7.08rem;margin: 0 auto;border-left: 1px solid #e6e6e6;border-right: 1px solid #e6e6e6;padding: .3rem 0;
			font-size: .32rem;color: #808080;overflow: hidden;background: white;}
			.data p{display: inline-block;float: right;}
			.data ul{width: 2.76rem;padding: 0 .32rem;float: left;}
			.data ul:nth-of-type(1){border-right: 1px solid #e5e3e6;}
			
			.conditions{background: #f3f8ff;width: 7.08rem;height: 3.2rem;border: 1px solid #e6e6e6;margin: 0 auto;font-size: .28rem;color: #a5a6a7;}
			.conditions  img{width: .5rem;display: inline-block;}
			.conditions .top{overflow: hidden;margin: 0 .2rem;padding: .3rem 0;border-bottom: 1px solid #e4e9f0;}
			.conditions .box{width: 1.3rem;text-align: center;overflow: hidden;float: left;}
			.conditions .bottom{overflow: hidden;margin: 0 auto;padding: .3rem .2rem;}
			.conditions  dl{float: left;text-align: center;width: 1.3rem;}
			.conditions  dl{border-right: 1px solid #e4e9f0;box-sizing: border-box;}
			
			.conditions .last{border-right:0;}
			.conditions  dd{text-align: center;}
			.bigbox{margin-bottom: .2rem;}
			#warm{color: #fd3156;}
			
			.noDiary{color: #979797;text-align: center;font-size: .36rem;display: none;}
			.noDiary img{display: block;margin: 2rem auto 0;width: 2.4rem;}
		</style>
	</head>
	<body>
		
		
			<div class="noDiary">
				<img src="assets/images/icon_default_bgImage@3x.png"/>
				<p>该用户还没有填写日志哦！</p>
			</div>
			<div id="wrapper" style="height:100%">
				<div id="scroller" class="cf">
					<div class="loading">
						
					</div>
		            <div id="content" style="">
		            	
		            </div>
		            <div id="pullUp" style="font-size: .28rem;color: #979797;text-align: center;line-height: .3rem;display: none;">
		                <span>上拉加载更多…</span>
		                <div class="pullUpIcon"></div>  
		            </div>
				</div>
			</div>
			
		<!--<div class="bigbox">
			<div class="head">
				<span class="blue"></span><span class="date">2016.06.10</span> | <span class="age">100</span>日龄 | 存栏<span class="num">9345</span>羽
			</div>
			<div class="data">
				<ul>
					<li>死淘：<p><span>20</span>羽</p></li>
					<li>成活率：<p><span>98</span>%</p></li>
					<li>总耗料量：<p><span>15</span>kg</p></li>
					<li>只采食量：<p><span>15</span>g</p></li>
					<li>平均蛋重：<p><span>15</span>g</p></li>
					<li>均匀度:<p><span>15</span>%</p></li>
				</ul>
				<ul>
					<li>总蛋重:<p><span>100</span>kg</p></li>
					<li>产蛋数:<p><span>20</span>枚</p></li>
					<li>产蛋率:<p><span>10</span>%</p></li>
					<li>畸形蛋:<p><span>25</span>枚</p></li>
					<li>破损率:<p><span>20</span>%</p></li>
				</ul>
			</div>
			<div class="conditions">
				<div class="top">
					<div class="box">
						<img src="assets/img/温度@3x.png" />
						<dl>
							<dt>温度</dt>
							<dd style="color: #fd3156;">23℃</dd>
						</dl>
					</div>
					<div class="box shidu">
						<img src="assets/img/湿度@3x.png"/>
						<dl>
							<dt>湿度</dt>
							<dd>33.4RH</dd>
						</dl>
					</div>
					<div class="box">
						<img src="assets/img/光照强度@3x.png"/>
						<dl>
							<dt>光照强度</dt>
							<dd>11Lux</dd>
						</dl>
					</div>
					<div class="box">
						<img src="assets/img/光照时长@3x.png"/>
						<dl>
							<dt>光照时长</dt>
							<dd>11h</dd>
						</dl>
					</div>
					<div class="box">
						<img src="assets/img/风速@3x.png"/>
						<dl class="last">
							<dt>风速</dt>
							<dd>1.2m/s</dd>
						</dl>
					</div>
				</div>
				<div class="bottom">
					<dl>
						<dt>NH<sub>3</sub></dt>
						<dd>0.0ppm</dd>
					</dl>
					<dl>
						<dt>CO<sub></sub></dt>
						<dd>0.0ppm</dd>
					</dl>
					<dl>
						<dt>CO<sub>2</sub></dt>
						<dd>505ppm</dd>
					</dl>
					<dl>
						<dt>SO<sub>2</sub></dt>
						<dd>505ppm</dd>
					</dl>
					<dl class="last">
						<dt>H<sub>2</sub>S</dt>
						<dd>505ppm</dd>
					</dl>
				</div>
			</div>
		</div>
		
		<div class="bigbox">
			<div class="head">
				<span class="blue"></span><span class="date">2016.06.9</span> | <span class="age">99</span>日龄 | 存栏<span class="num">9345</span>羽
			</div>
			<div class="data">
				<ul>
					<li>死淘：<p><span>20</span>羽</p></li>
					<li>成活率：<p><span>98</span>%</p></li>
					<li>总耗料量：<p><span>15</span>kg</p></li>
					<li>只采食量：<p><span>15</span>g</p></li>
					<li>平均蛋重：<p><span>15</span>g</p></li>
					<li>均匀度:<p><span>15</span>%</p></li>
				</ul>
				<ul>
					<li>总蛋重:<p><span>100</span>kg</p></li>
					<li>产蛋数:<p><span>20</span>枚</p></li>
					<li>产蛋率:<p><span>10</span>%</p></li>
					<li>畸形蛋:<p><span>25</span>枚</p></li>
					<li>破损率:<p><span>20</span>%</p></li>
				</ul>
			</div>
			<div class="conditions">
				<div class="top">
					<div class="box">
						<img src="assets/img/温度@3x.png" />
						<dl>
							<dt>温度</dt>
							<dd style="color: #fd3156;">23℃</dd>
						</dl>
					</div>
					<div class="box shidu">
						<img src="assets/img/湿度@3x.png"/>
						<dl>
							<dt>湿度</dt>
							<dd>33.4RH</dd>
						</dl>
					</div>
					<div class="box">
						<img src="assets/img/光照强度@3x.png"/>
						<dl>
							<dt>光照强度</dt>
							<dd>11Lux</dd>
						</dl>
					</div>
					<div class="box">
						<img src="assets/img/光照时长@3x.png"/>
						<dl>
							<dt>光照时长</dt>
							<dd>11h</dd>
						</dl>
					</div>
					<div class="box">
						<img src="assets/img/风速@3x.png"/>
						<dl class="last">
							<dt>风速</dt>
							<dd>1.2m/s</dd>
						</dl>
					</div>
				</div>
				<div class="bottom">
					<dl>
						<dt>NH<sub>3</sub></dt>
						<dd>0.0ppm</dd>
					</dl>
					<dl>
						<dt>CO<sub></sub></dt>
						<dd>0.0ppm</dd>
					</dl>
					<dl>
						<dt>CO<sub>2</sub></dt>
						<dd>505ppm</dd>
					</dl>
					<dl>
						<dt>SO<sub>2</sub></dt>
						<dd>505ppm</dd>
					</dl>
					<dl class="last">
						<dt>H<sub>2</sub>S</dt>
						<dd>505ppm</dd>
					</dl>
				</div>
			</div>
		</div>-->
		
		<script src="assets/js/zepto.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="assets/js/zepto.tap.js" type="text/javascript" charset="utf-8"></script>
		<script src="assets/js/artTamplate.js" type="text/javascript" charset="utf-8"></script>
		<script src="assets/js/iscroll.js" type="text/javascript" charset="utf-8"></script>
		<script src="assets/js/iscroll-probe.js" type="text/javascript" charset="utf-8"></script>
		<script src="assets/js/spin.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="assets/js/md5-min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/html" id="chickenDiaryData_tmp1">
			{{ each data as value index }}
					<div class="bigbox">
						<div class="head">
							<span class="blue"></span><span class="date">{{ value.date | getDate }}</span> | <span class="age">{{value.current_days}}</span>日龄 | 存栏<span class="num">{{value.current_count}}</span>羽
						</div>
						<div class="data">
							<ul>
								<li>死淘：<p><span>{{value.out_numbers}}</span>羽</p></li>
								<li>成活率：<p><span>{{value.chenghuolv}}</span>%</p></li>
								<li>总耗料量：<p><span>{{value.total_feedweight}}</span>kg</p></li>
								<li>只采食量：<p><span>{{value.zhicaishiliang}}</span>g</p></li>
								<li>平均蛋重：<p><span>{{value.aver_eggweight}}</span>g</p></li>
								<li>均匀度:<p><span>{{value.evenness}}</span>%</p></li>
							</ul>
							<ul>
								<li>总蛋重:<p><span>{{value.total_eggweight}}</span>kg</p></li>
								<li>产蛋数:<p><span>{{value.chandanshu}}</span>枚</p></li>
								<li>产蛋率:<p><span>{{value.chandanlv}}</span>%</p></li>
								<li>畸形蛋:<p><span>{{value.abnormal_eggs}}</span>枚</p></li>
								<li>破损率:<p><span>{{value.posunlv}}</span>%</p></li>
							</ul>
						</div>
						<div class="conditions">
							<div class="top">
								<div class="box">
									<img src="assets/images/温度@3x.png" />
									<dl>
										<dt>温度</dt>
										<dd >{{value.temperature}}<span>℃</span></dd>
									</dl>
								</div>
								<div class="box shidu">
									<img src="assets/images/湿度@3x.png"/>
									<dl>
										<dt>湿度</dt>
										<dd>{{value.humidity}}<span>RH</span></dd>
									</dl>
								</div>
								<div class="box">
									<img src="assets/images/光照强度@3x.png"/>
									<dl>
										<dt>光照强度</dt>
										<dd>{{value.light_intensity}}<span>Lux</span></dd>
									</dl>
								</div>
								<div class="box">
									<img src="assets/images/光照时长@3x.png"/>
									<dl>
										<dt>光照时长</dt>
										<dd>{{value.light_duration}}<span>h</span></dd>
									</dl>
								</div>
								<div class="box">
									<img src="assets/images/风速@3x.png"/>
									<dl class="last">
										<dt>风速</dt>
										<dd>{{value.wind_velocity}}<span>m/s</span></dd>
									</dl>
								</div>
							</div>
							<div class="bottom">
								<dl>
									<dt>NH<sub>3</sub></dt>
									<dd>{{value.nh3}}<span>ppm</span></dd>
								</dl>
								<dl>
									<dt>CO<sub></sub></dt>
									<dd>{{value.co}}<span>ppm</span></dd>
								</dl>
								<dl>
									<dt>CO<sub>2</sub></dt>
									<dd>{{value.co2}}<span>ppm</span></dd>
								</dl>
								<dl>
									<dt>SO<sub>2</sub></dt>
									<dd>{{value.so2}}<span>ppm</span></dd>
								</dl>
								<dl class="last">
									<dt>H<sub>2</sub>S</dt>
									<dd>{{value.h2s}}<span>ppm</span></dd>
								</dl>
							</div>
						</div>
					</div>
			{{/each}}
		</script>
		<script type="text/javascript">
			$(function(){
				var height=document.documentElement.clientHeight;
				var coop_id;
				var user_id;
				var total_page;
				var page=1;
				var flag=false;
				$("#wrapper").height(height)
				if(localStorage.getItem("customerDetails")){
					coop_id=JSON.parse(localStorage.getItem("customerDetails")).coop_id;
					user_id=JSON.parse(localStorage.getItem("customerInfo")).user_id;
				};
				function getLocalTime(nS) {     
	   					 return new Date(parseInt(nS) * 1000).toJSON().slice(0,10) 
	   				}
				template.helper("getDate",function(date){
					
							return getLocalTime(date)
					
				})
				var myScroll = new IScroll('#wrapper', {
					probeType: 2,
				    mouseWheel: true,
				    scrollbars: true,
				    bounce: true


				});
				myScroll.on('scroll',positionJudge);
				myScroll.on("scrollEnd",action);
				var version="1.2.2";
				var signature=hex_md5("user_id="+user_id+"&coop_id="+coop_id+"&page="+page+"&version=1.2.2"+version+"Tv,cM02kjf^lWoU")
				$.get("http://weixin.yangjiguanjia.com/Api/Logs/show?user_id="+user_id+"&coop_id="+coop_id+"&page="+page+"&signature="+signature+"&version="+version,{},function(data){
							if(data.code===1){
								//alert(data.msg)
								total_page=data.result.totalPage_count;
								var html = template("chickenDiaryData_tmp1",{data:data.result.data});
							 	$("#content").append(html);
							 	myScroll.refresh();
							}else{
								
								$(".noDiary").css("display","block");
								$("#wrapper").css("display","none");
							}	
				});
				
				
				var pullUpFlag;
				var pullUp;
				var spinner;
				function positionJudge(){
					if(!flag){
						if(this.y<(this.maxScrollY-40)){   //判断上拉
					    	$("#pullUp").css("display","block")
					    	$("#pullUp").html("放开加载更多！--")
					       // pullUp.innerHTML = "放开刷新页面";
					        pullUpFlag = 1;
					    }
					}
					
				    
				}
				function action(){
				    if(pullUpFlag==1){
				        pullUpAction();
				        //$("#pullUp").html("加载中…");
				        pullUpFlag = 0;
				    }
				}
				
				
				function pullUpAction(){
						
			  //  spinner.style.display = "block";
				   if(page<total_page){
				   
				   		page++;
				   		signature=hex_md5("user_id="+user_id+"&coop_id="+coop_id+"&page="+page+"&version=1.2.2"+version+"Tv,cM02kjf^lWoU")
				   	    $.get("http://weixin.yangjiguanjia.com/Api/Logs/show?user_id="+user_id+"&coop_id="+coop_id+"&page="+page+"&signature="+signature+"&version="+version,{},function(data){
								if(data.code===1){
									var html = template("chickenDiaryData_tmp1",{data:data.result.data});
								 	$("#content").append(html)
								 	$("#pullUp").html("")
								 	myScroll.refresh();
								}else{
									alert(data.msg);
								}
						})
				   }else{
				   		flag=true;
				   		$("#pullUp").html("已经全都加载完了哦！");
				   }
				   
				        
				       // spinner.style.display = "none";
				      
				}
				function updatePosition(){
					pullDown.innerHTML = this.y>>0;
				}
//				document.addEventListener('touchmove', function (e) {
//				    e.preventDefault();
//				}, false);
				
				
			})
		</script>
	</body>
</html>
