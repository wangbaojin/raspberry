<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name = "format-detection" content = "telephone=no">
		<title>认证信息</title>
		<script src="assets/js/rem.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="assets/css/reset.css"/>
		<link rel="stylesheet" type="text/css" href="assets/css/weui.css"/>
		<style type="text/css">
			html,body{background: #f7f7f7;}
			header{width: 100%;height: .9rem;background: #f7f7f7;overflow: hidden;}
			header div img{display: inline-block;width: .35rem;margin-right: .06rem;}
			header div{text-align: center;font-size: .32rem;color: #666666;margin-top: .24rem;}
			
			section .photo{width: 6.88rem;height: .98rem;border: 1px solid #e6e6e6;background: white;line-height: .98rem;color: #999999;
			font-size: .3rem;margin-left:.2rem;overflow: hidden;display: block;-webkit-box-sizing: border-box;}
			section .photo .camera{border: 1px solid #b3b3b3;width: .52rem;border-radius: 50%;text-align: center;
			height: .52rem;line-height: .52rem;overflow: hidden;margin: .22rem 0 0 .22rem;display: inline-block;float: left;}
			section .photo .camera img{display: inline-block;width: .34rem;margin-top: .13rem;}
			section .photoCon{height: .9rem;line-height: .9rem;font-size: .32rem;color: #4d4d4d;margin-left: .2rem;}
			section .red{color: #fe3d62;}
			section .photo .add{line-height: .98rem;display: block;width: 1rem;height: 1rem;float: left;
			margin-left: .2rem;}
			
			section{width: 100%;-webkit-box-sizing: border-box;}
			section .finsh{width: 100%;height: 1rem;text-align: center;line-height: 1rem;color: white;background: #faca3a;
			margin-top: 1rem;font-size: .3rem;display: block;border: 0;}
			.finshbox{text-align: center;}
		
			.showPhoto{width: 1.78rem;height: 1.78rem;border: 1px solid #e6e6e6;position: relative;
			background: white;overflow: ;margin-left: .2rem;display: none;}
			.showPhoto img{display: block;width: 1.66rem;margin: .4rem auto 0;height: 1.03rem;}
			.showPhoto .close{position: absolute;top: -0.12rem;right: -0.12rem;overflow: hidden;}
			.close img{display: block;width: .24rem;margin: 0;height: auto;}
		</style>
	</head>
	<body>
		<header>
			<div>
				<img src="assets/images/list.png"/>订单号：<span class="orderNum"></span>
			</div>
		</header>
		
			<section>
				<div class="box">
					<div class="photoCon" >
						请拍摄身份证正面照<span class="red">*</span>
					</div>
					<div class="photo">
						<div class="camera">
							<img src="assets/images/camera.png"/>
						</div>
						<sup class="add">添加</sup>
					</div>
					<div class="showPhoto">
						<img  class="oImg" />
						<span class="close"><img src="assets/images/close.png"/></span>
					</div>
					<input type="hidden" name="idCard" id="" value="" class="hidden"/>
				</div>
				
				<div class="box">
					<div class="photoCon">
						请拍摄银行卡正面照<span class="red">*</span>
					</div>
					<div class="photo">
						<div class="camera">
							<img src="assets/images/camera.png"/>
						</div>
						<sup class="add">添加</sup>
					</div>
					<div class="showPhoto">
						<img  class="oImg"/>
						<span class="close"><img src="assets/images/close.png"/></span>
					</div>
					<input type="hidden" name="bankCard" id="" value="" class="hidden" />
				</div>
				<div class="box">
					<div class="photoCon">
						请拍摄养殖动物防疫条件合格证照<span class="red">*</span>
					</div>
					<div class="photo">
						<div class="camera">
							<img src="assets/images/camera.png"/>
						</div>
						<sup class="add">添加</sup>
					</div>
					<div class="showPhoto">
						<img  class="oImg"/>
						<span class="close"><img src="assets/images/close.png"/></span>
					</div>
					<input type="hidden" name="fangyi" id="" value="" class="hidden" />
				</div>
				<div class="box">
					<div class="photoCon">
						请拍摄畜禽养殖代码证<span class="red">*</span>
					</div>
					<div class="photo">
						<div class="camera">
							<img src="assets/images/camera.png"/>
						</div>
						<sup class="add">添加</sup>
					</div>
					<div class="showPhoto">
						<img  class="oImg"/>
						<span class="close"><img src="assets/images/close.png"/></span>
					</div>
					<input type="hidden" name="yangzhi" id="" value="" class="hidden" />
				</div>
				<div class="box">
					<div class="photoCon">
						请拍摄经营许可证<span class="red">*</span>
					</div>
					<div class="photo">
						<div class="camera">
							<img src="assets/images/camera.png"/>
						</div>
						<sup class="add">添加</sup>
					</div>
					<div class="showPhoto">
						<img  class="oImg"/>
						<span class="close"><img src="assets/images/close.png"/></span>
					</div>
					<input type="hidden" name="manage" id="" value="" class="hidden" />
				</div>
				<div class="box">
					<div class="photoCon">
						请拍摄养殖场标牌及大门(含鸡场老板)<span class="red">*</span>
					</div>
					<div class="photo">
						<div class="camera">
							<img src="assets/images/camera.png"/>
						</div>
						<sup class="add">添加</sup>
					</div>
					<div class="showPhoto">
						<img  class="oImg"/>
						<span class="close"><img src="assets/images/close.png"/></span>
					</div>
					<input type="hidden" name="biaopai" id="" value="" class="hidden" />
				</div>
				<div class="box">
					<div class="photoCon">
						请拍摄养殖场全景及各养殖单位(栋舍)码证<span class="red">*</span>
					</div>
					<div class="photo">
						<div class="camera">
							<img src="assets/images/camera.png"/>
						</div>
						<sup class="add">添加</sup>
					</div>
					<div class="showPhoto">
						<img  class="oImg"/>
						<span class="close"><img src="assets/images/close.png"/></span>
					</div>
					<input type="hidden" name="quanjing" id="" value="" class="hidden" />
				</div>
				<div class="box">
					<div class="photoCon">
						请拍摄养殖场平面图<span class="red">*</span>
					</div>
					<div class="photo">
						<div class="camera">
							<img src="assets/images/camera.png"/>
						</div>
						<sup class="add">添加</sup>
					</div>
					<div class="showPhoto">
						<img  class="oImg"/>
						<span class="close"><img src="assets/images/close.png"/></span>
					</div>
					<input type="hidden" name="pingmian" id="" value="" class="hidden" />
				</div>
				<div class="box">
					<div class="photoCon">
						请拍摄生产、免疫记录拍照<span class="red">*</span>
					</div>
					<div class="photo">
						<div class="camera">
							<img src="assets/images/camera.png"/>
						</div>
						<sup class="add">添加</sup>
					</div>
					<div class="showPhoto">
						<img  class="oImg"/>
						<span class="close"><img src="assets/images/close.png"/></span>
					</div>
					<input type="hidden" name="issue" id="" value="" class="hidden" />
				</div>
				<div class="finshbox">
					<a href="javascript:void(0)"   class="finsh">完  成</a>
				</div>
			</section>
		
		<div id="loadingToast" class="weui_loading_toast" style="display:none;">
			    <div class="weui_mask_transparent"></div>
			    <div class="weui_toast">
			        <div class="weui_loading">
			            <div class="weui_loading_leaf weui_loading_leaf_0"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_1"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_2"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_3"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_4"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_5"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_6"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_7"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_8"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_9"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_10"></div>
			            <div class="weui_loading_leaf weui_loading_leaf_11"></div>
			        </div>
			        <p class="weui_toast_content" style="color: #FFFFFF;">数据提交中！</p>
			    </div>
		</div>
		<script type="text/javascript" src="assets/js/zepto.min.js"></script>
		<script type="text/javascript" src="assets/js/zepto.tap.js"></script>
		<script src="assets/conf/common.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
		<script src="assets/js/md5-min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			$(function(){
				//alert(document.referrer)
				var version="1.2.2";
				var signature=hex_md5("version=1.2.2"+version+"Tv,cM02kjf^lWoU");
				var url=location.href;
				var hidden=$(".hidden");
				$.ajax({
					  type: 'GET',
					  url: validate.url+"/Api/Wechat/jssdkConnect?signature="+signature+"&version="+version+"&url="+url,
					  // post payload:
					  success:  function(data){
					  		data=JSON.parse(data);
						   	wx.config({
									debug : true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
									appId :"wxae085b95829a51af", // 必填，appID公众号的唯一标识
									timestamp :1483606506, // 必填，生成签名的时间戳
									nonceStr :"Tv4WBbL2eeFq2UwH", // 必填，生成签名的随机串
									signature :"f1cfce1b6db68a31cf13e58332fff146e86cab03",// 必填，签名，见附录1
									jsApiList : [ 'chooseImage','uploadImage' ]
									// 必填，需要使用的JS接口列表，所有JS接口列表见附录2
								});
					  },
					  error: function(xhr, type){
					    alert('请求出错!')
					  }
					
				});
				
				if(localStorage.getItem("orderInfo")){
					var num = JSON.parse(localStorage.getItem("orderInfo")).orderNum;
					$(".orderNum").html(num);
				}
				
//				if(localStorage.getItem("orderInfo")){
//					var num = JSON.parse(localStorage.getItem("orderInfo")).orderNum;
//				};
//				if(localStorage.getItem("images")){
//					var imgOrderNum = JSON.parse(localStorage.getItem("images")).orderNum;
//					var imgList = JSON.parse(localStorage.getItem("images")).localId;
//					if(imgOrderNum==num){
//						for(var i=0;i<$(".oImg").length;i++){
//						 $(".oImg").eq(i).attr('src',imgList[i])
//						}
//						
//					}
//					
//				}else{
//					
//				}
				var images = {  
				        localId: [],  
				        serverId:[]
				     };
				images.localId.length=9;
				images.serverId.length=9;
				var oPhoto=document.getElementsByClassName("photo");
				var oClose=document.getElementsByClassName("close");
				wx.ready(function(){
				    for(var i=0;i<$(".photo").length;i++){
				    	oPhoto[i].index=i
				        $('.photo').eq(i).on('tap',function(event) {
				      	   var index=this.index;
				      	
				        	//event.preventDefault();
							// 选择张片	
						    wx.chooseImage({
						        count: 1, // 默认9
						        sizeType: ['compressed'], // 可以指定是原图还是压缩图，默认二者都有
						        sourceType: ['camera'],// 可以指定来源是相册还是相机，默认二者都有
						        success: function(res){
						        	  images.localId[index]=res.localIds[0];
							          var localIds = res.localIds[0]; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
							        //  localStorage.setItem("images",JSON.stringify({"localId":images.localId,"serverId":images.serverId,"orderNum":num}));
							           $(".hidden").eq(index).val(localIds);
							           $(".oImg").eq(index).attr('src',localIds);
							            // 上传照片
							    		
							            $(".showPhoto").eq(index).css({"display":"block"});
							            $(".photo").eq(index).css({"display":"none"});
								        wx.uploadImage({
								                localId: '' + localIds,
								                isShowProgressTips: 1,
								                success: function(res){								           
								                    $(".hidden").eq(index).val(res.serverId);
								                    //$(obj).next().val(serverId); // 把上传成功后获取的值附上
								               		//$(".photoCon").eq(index).html($(".hidden").eq(index).val())
								                }
								            })
							        }
						    });
				    	});
						

					}; 
			   })
			   
			   		for(var a=0;a<$(".close").length;a++){
			   			oClose[a].index=a
			   			 $(".close").eq(a).on("tap",function(){
			   			 	    var index=this.index;
					  			$(".oImg").eq(index).attr('src', null);
					  			images.localId[index]="";
					  			images.serverId[index]="";
					  			$(".hidden").eq(index).val("");
				           // 	$(this).parent().css({"display":"none"});
				            	$(".showPhoto").eq(index).css({"display":""});
				          	    $(".photo").eq(index).css({"display":""});
			   				
			   			})
			   		}
			   				
			   		
			   					
				      
			   
			   $(".finsh").on("tap",function(event){
			// alert($(".hidden").eq(6).val())
					//alert(typeof($(".orderNum").html()))
			   		event.preventDefault();
					var count = 0;
					var i=0;
//				    $(".hidden").each(function(){
//				        if ($(this).val()=="" ){
//				            count++;
//				        }
//				    }); 
				    for(var k=0;k<9;k++){
				    	if(hidden.eq(k).val()==""){
				    		count++;
				    	}
				    }
//				    for(var k=0;k<9;k++){
//				    	if(images.serverId[k]==""){
//				    		 count++;
//				    	}
//				    	
//				    }
				
				    if(count >0 ){
				        alert("请填写完整信息！");
				        return
				    }
				    if(count==0){
//				    	function upload(){
//					    	wx.uploadImage({
//				                localId: '' + $(".hidden").eq(i).val(),
//				                isShowProgressTips: 1,
//				                success: function(res){	
//				                	i++;
//				                    serverId = res.serverId;
//				                //    $(".photoCon").eq(0).html(serverId)
//				                    //$(obj).next().val(serverId); // 把上传成功后获取的值附上
//					                if (i < 9) {  
//					                   upload();  
//					                }else{
//					                	$('#loadingToast').show();
//					                	$("#formid").submit();
//					                }
//				                }
//							 });	  	
//				    	}
//			    	    upload(); 		

					
						var images={};
				    	images.idCard= hidden.eq(0).val();
						images.bankCard=hidden.eq(1).val();
						images.fangyi=hidden.eq(2).val();
						images.yangzhi=hidden.eq(3).val();
						images.manage=hidden.eq(4).val();
						images.biaopao=hidden.eq(5).val();
						images.quanjing=hidden.eq(6).val();
						images.pingmian=hidden.eq(7).val();
						images.issue=hidden.eq(8).val();
						
					
						
   						//var version="1.2.2";
					//	var signature=hex_md5(version+"&images="+images+"&orderID="+$(".orderNum").html()+"&version=1.2.2"+"Tv,cM02kjf^lWoU")
						$("#loadingToast").show()
						$.post(validate.url+"/Wechat/downOrderPic",{"images":JSON.stringify(images),"order_sn":num},function(data){
							
							if(data==1){
								$("#loadingToast").hide();
								alert("上传成功！请耐心等待审核...");
								//location.href="/identityInfo.html";	
								location.href="orderManage.html";
							}else{						
								$("#loadingToast").hide();
								alert("上传失败！")
								
							}
						})
				    }
			   })
			   
			})
		</script>
	</body>
</html>
